---
title: "Caso 1 Consultoría"
author:
  - name: "Autores"
    affiliation: "Departamento de estadística. Universidad Nacional de Colombia."
address:
  - Departamento de estadística. Universidad Nacional de Colombia.
format: 
  html:
    grid: 
      body-width: 1000px
toc: true
echo: false
code-fold: true
code-summary: ""
warning: false
# embed-resources: true
editor_options: 
  chunk_output_type: console
---

```{r}
# Librerias 
library(readxl)
library(nortest)
library(dplyr)
library(ggplot2)
library(GGally) # para la funcion ggpairs
library(gt)
library(gtExtras)
```

## Lectura de datos

```{r}
# Lectura base de datos
datos <- read_excel("Datos/Corregida - COMPILADO DATOS COMUNIDAD DE CUIDADO Y CENTRO DÍA.xlsx", 
                      range = "B2:AN561", col_types = c("date", 
                      "skip", "text", "text", "text", "skip", 
                      "text", "numeric", "text", "skip", 
                      "skip", "skip", "skip", "numeric", 
                      "skip", "skip", "skip", "skip", "numeric", 
                      "skip", "skip", "skip", "skip", "numeric", 
                      "skip", "skip", "skip", "skip", "numeric", 
                      "skip", "skip", "skip", "skip", "numeric", 
                      "skip", "skip", "skip", "skip", "numeric"))
colnames(datos) <- c("Fecha", "Localidad", "Programa", "Unidad_atencion", "Sexo", 
                     "Edad", "Etnia", "Peso", "Talla", "LRT_CM","LRT_A", "LRM_90","LRM_R")
datos$Sexo <- as.factor(datos$Sexo)
datos$Etnia <- as.factor(datos$Etnia)
datos <- datos |> as.data.frame()
head(datos) |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

## Análisis descriptivo

### Distribución, atípicos y test de normalidad

#### Sexo

```{r}
#| layout-ncol: 2

# summary(datos$Sexo)
# summary(datos$Sexo)/length(datos$Sexo)

datos_resumen <- datos %>%
  dplyr::count(Sexo) %>%
  dplyr::mutate(porcentaje = n / sum(n) * 100)
datos_resumen |> gt() |> gtExtras::gt_theme_538()

ggplot(datos_resumen, aes(x = "", y = porcentaje, fill = Sexo)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  theme_void() +  # Elimina fondo y ejes
  labs(title = "Porcentaje de Hombres y Mujeres", fill = "Sexo") +
  geom_text(aes(label = paste0(round(porcentaje, 1), "%")),
            position = position_stack(vjust = 0.5), color = "white")
```

La muestra cuenta con 284 personas de sexo femenino y 275 masculino

#### Edad

Resumen de la variable `Edad`:

```{r}
summary(datos$Edad)
```

Distribución de la variable `Edad`

```{r}
#| layout-ncol: 2
hist(datos$Edad, freq=FALSE)
lines(density(datos$Edad), col ="red")
box_Edad <- boxplot(datos$Edad)
```

Datos atípicos en la variable `Edad`:

```{r}
datos[which(datos$Edad>box_Edad$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> 
  tab_options(table.font.size = 9)
```

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$Edad) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Edad, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$Edad) # No se tiene normalidad en la edad según el test de lillie
```

El mínimo de edad en la muestra es `r summary(datos$Edad)[1]` años, el máximo son 95 años, la media son 71 años y la mediana 71.77 años. Parece haber dos datos atípicos (93 y 95 años). No hay evidencia estadística de que la edad siga una distribución normal, el test Shapiro-Wilk arrojó un p-valor 7.771e-09, y el test Lilliefors muestra un p-valor de 1.5693-09.

#### Etnia

Resumen de la variable `Etnia`:

```{r}
datos %>%
  dplyr::count(Etnia) %>%
  dplyr::mutate(porcentaje = n / sum(n) * 100) |> 
  gt() |> gtExtras::gt_theme_538()
# No se debería incluír un factor tan sesgado en el modelo
# Se puede tener en cuenta, sim embargo
```

#### Peso

Resumen de la variable `Peso`:

```{r}
summary(datos$Peso)
```

Distribución de la variable `Peso`:

```{r}
#| layout-ncol: 2
hist(datos$Peso, freq = FALSE)
lines(density(datos$Peso), col = "red")
box_peso <- boxplot(datos$Peso)
```

Distribución de la variable `Peso` distinguiendo por `Sexo`:

```{r}
box_peso_fm <- boxplot(datos$Peso ~ datos$Sexo)
```

Datos atípicos en la variable `Peso`:

```{r}
datos[which(datos$Peso>box_peso$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$Peso>box_peso_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$Peso>box_peso_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 8)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$Peso) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$Peso) # No se tiene normalidad en la edad según el test de Lilliefors
```

El mínimo de peso en la muestra es 34.20 kg, el máximo son 101.8 kg, la media son 63.32 kg y la mediana 62.8 kg. En la muestra junta, parece haber ocho datos atípicos (101.80, 98.70,  97.65,  97.40,  97.10,  95.60,  95.10 y  94.20), cuando se separa por Sexo, parece haber dos datos atípicos en Femenino (97.10 y  91.6), y en Masculino cuatro (101.80, 98.70, 97.65 y 97.40). No hay evidencia estadística de que el peso siga una distribución normal, el test Shapiro-Wilk arrojó un p-valor 6.466e-05, y el test Lilliefors muestra un p-valor de 0.003945.

#### Talla

Resumen de la variable `Talla`:

```{r}
summary(datos$Talla)
```

Distribución de la variable `Talla`:

```{r}
#| layout-ncol: 2
hist(datos$Talla, freq = FALSE)
lines(density(datos$Talla), col = "red")
box_talla <- boxplot(datos$Talla)
```

Distribución de la variable `Talla` distinguiendo por `Sexo`:

```{r}
box_talla_fm <- boxplot(datos$Talla ~ datos$Sexo)
```

Datos atípicos en la variable `Talla`:

```{r}
datos[which(datos$Talla<box_talla$stats[1]|datos$Talla>box_talla$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$Talla<box_talla_fm$stats[1,1]|(datos |> filter(Sexo == "Femenino"))$Talla>box_talla_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$Talla<box_talla_fm$stats[1,2]|(datos |> filter(Sexo == "Masculino"))$Talla>box_talla_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$Talla) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$Talla) # No se tiene normalidad en la edad según el test de Lilliefors
```

El mínimo de talla en la muestra es 127.1 cm, el máximo son 181.5 cm, la media son 155.9 cm y la mediana 155.2 cm. En la muestra junta, parece haber un dato atípico (127.1), cuando se separa por Sexo, parece haber tres datos atípicos en Femenino (133.00, 127.10, 129.25 y 132.55), y en Masculino dos (142.00 y 141.50). El test Shapiro-Wilk arrojó un p-valor 0.05006 sugiriendo normalidad pero sin ser muy significativo , mientras que el test Lilliefors muestra un p-valor de 0.04416, por lo que no habría normalidad.

#### Longitud Rodilla Talón con cinta métrica `LRT_CM`

Resumen de la variable `LRT_CM`:

```{r}
summary(datos$LRT_CM)
```

Distribución de la variable `LRT_CM`:

```{r}
#| layout-ncol: 2
hist(datos$LRT_CM, freq = FALSE)
lines(density(datos$LRT_CM), col = "red")
box_LRT_CM <- boxplot(datos$LRT_CM)
```

Distribución de la variable `LRT_CM` distinguiendo por `Sexo`:

```{r}
box_LRT_CM_fm <- boxplot(datos$LRT_CM ~ datos$Sexo)
```

Datos atípicos en la variable `LRT_CM`:

```{r}
datos[which(datos$LRT_CM<box_LRT_CM$stats[1]|datos$LRT_CM>box_LRT_CM$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$LRT_CM<box_LRT_CM_fm$stats[1,1]|(datos |> filter(Sexo == "Femenino"))$LRT_CM>box_LRT_CM_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$LRT_CM<box_LRT_CM_fm$stats[1,2]|(datos |> filter(Sexo == "Masculino"))$LRT_CM>box_LRT_CM_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$LRT_CM) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$LRT_CM) # No se tiene normalidad en la edad según el test de Lilliefors
```

El mínimo de LRT con cinta métrica en la muestra es 38 cm, el máximo son 59 cm, la media son 48.99 cm y la mediana 48.65 cm. En la muestra junta, parece haber tres datos atípicos (59, 39 y 38), cuando se separa por Sexo, parece haber dos datos atípicos en Femenino (39 y 38), y en Masculino uno (59). No hay evidencia estadística de que la LRT con cinta métrica siga una distribución normal, el test Shapiro-Wilk arrojó un p-valor 0.02122, y el test Lilliefors muestra un p-valor de 0.008985.

#### Longitud Rodilla Talón con Antropómetro `LRT_A`

Resumen de la variable `LRT_A`:

```{r}
summary(datos$LRT_A)
```

Distribución de la variable `LRT_A`:

```{r}
#| layout-ncol: 2
hist(datos$LRT_A, freq = FALSE)
lines(density(datos$LRT_A), col = "red")
box_LRT_A <- boxplot(datos$LRT_A)
```

Distribución de la variable `LRT_A` distinguiendo por `Sexo`:

```{r}
box_LRT_A_fm <- boxplot(datos$LRT_A ~ datos$Sexo)
```

Datos atípicos en la variable `LRT_A`:

```{r}
datos[which(datos$LRT_A<box_LRT_A$stats[1]|datos$LRT_A>box_LRT_A$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$LRT_A<box_LRT_A_fm$stats[1,1]|(datos |> filter(Sexo == "Femenino"))$LRT_A>box_LRT_A_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$LRT_A<box_LRT_A_fm$stats[1,2]|(datos |> filter(Sexo == "Masculino"))$LRT_A>box_LRT_A_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$LRT_A) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$LRT_A) # No se tiene normalidad en la edad según el test de Lilliefors
```

El mínimo de LRT con antropómetro en la muestra es 36.85 cm, el máximo son 58.35 cm, la media son 47.53 cm y la mediana 47.4 cm. En la muestra junta, parece haber tres datos atípicos (58.35, 37.00 y 36.85), cuando se separa por Sexo, parece haber tres datos atípicos en Femenino (37.00, 36.85 y 38.20), y en Masculino dos (57.65 y 58.35). No hay evidencia estadística de que la LRT con antropómetro siga una distribución normal, el test Shapiro-Wilk arrojó un p-valor 0.04419, y el test Lilliefors muestra un p-valor de 0.01168.

#### Longitud Rodilla-Maléolo a 90° `LRM_90`

Resumen de la variable `LRM_90`:

```{r}
summary(datos$LRM_90)
```

Distribución de la variable `LRM_90`:

```{r}
#| layout-ncol: 2
hist(datos$LRM_90, freq = FALSE)
lines(density(datos$LRM_90), col = "red")
box_LRM_90<- boxplot(datos$LRM_90)
```

Distribución de la variable `LRM_90` distinguiendo por `Sexo`:

```{r}
box_LRM_90_fm <- boxplot(datos$LRM_90 ~ datos$Sexo)
```

Datos atípicos en la variable `LRM_90`:

```{r}
datos[which(datos$LRM_90<box_LRM_90$stats[1]|datos$LRM_90>box_LRM_90$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$LRM_90<box_LRM_90_fm$stats[1,1]|(datos |> filter(Sexo == "Femenino"))$LRM_90>box_LRM_90_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$LRM_90<box_LRM_90_fm$stats[1,2]|(datos |> filter(Sexo == "Masculino"))$LRM_90>box_LRM_90_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$LRM_90) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$LRM_90) # No se tiene normalidad en la edad según el test de Lilliefors
```

#### Longitud Rodilla-Maléolo la pierna totalmente estirada `LRM_R`

Resumen de la variable `LRM_R`:

```{r}
summary(datos$LRM_R)
```

Distribución de la variable `LRM_R`:

```{r}
#| layout-ncol: 2
hist(datos$LRM_R, freq = FALSE)
lines(density(datos$LRM_R), col = "red")
box_LRM_R<- boxplot(datos$LRM_R)
```

Distribución de la variable `LRM_R` distinguiendo por `Sexo`:

```{r}
box_LRM_R_fm <- boxplot(datos$LRM_R ~ datos$Sexo)
```

Datos atípicos en la variable `LRM_R`:

```{r}
datos[which(datos$LRM_R<box_LRM_R$stats[1]|datos$LRM_R>box_LRM_R$stats[5]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

Datos atípicos cuando se distingue por `Sexo`:

::: {layout-nrow=2}

###  Mujeres

```{r}
(datos |> filter(Sexo == "Femenino"))[which((datos |> filter(Sexo == "Femenino"))$LRM_R<box_LRM_R_fm$stats[1,1]|(datos |> filter(Sexo == "Femenino"))$LRM_R>box_LRM_R_fm$stats[5,1]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```
 
### Hombres

```{r}
(datos |> filter(Sexo == "Masculino"))[which((datos |> filter(Sexo == "Masculino"))$LRM_R<box_LRM_R_fm$stats[1,2]|(datos |> filter(Sexo == "Masculino"))$LRM_R>box_LRM_R_fm$stats[5,2]),-c(1,2)] |> gt() |> gtExtras::gt_theme_538() |> tab_options(table.font.size = 9)
```

:::

Pruebas de Normalidad:

```{r}
#| layout-ncol: 2
shapiro.test(datos$LRM_R) # No se tiene normalidad en la edad según el test de Shapiro-Wilks
# ks.test(datos$Peso, pnorm) # No se tiene normalidad en la edad según el test de Kolmogorov-Smirnov
lillie.test(datos$LRM_R) # No se tiene normalidad en la edad según el test de Lilliefors
```

El mínimo de LRM con la pierna recta en la muestra es 31.45 cm, el máximo son 52.5 cm, la media son 42.53 cm y la mediana 42.50 cm. En la muestra junta, parece haber un dato atípico (31.45), cuando se separa por Sexo, parece haber dos datos atípicos en Femenino (33.50 y 31.45), y en Masculino cuatro (52.50, 51.35, 52.50, 51.25, 37.70 y 37.75). Con el test Shapiro-Wilk parece haber normalidad pues arrojó un p-valor 0.08377, mientras que el test Lilliefors muestra un p-valor de 0.004458, por lo que no habría normalidad.

### Análisis de correlación

```{r}
ggpairs(
  datos[-c(1:5, 7)],  # Tu subconjunto de datos
  lower = list(continuous = wrap("smooth", method = "lm", color = "red")),  # Línea de regresión en rojo
  title = "Matriz de Gráficos con Regresión Roja"
)
```

Existe una fuerte correlación lineal positiva entre la variable talla y cada una de las mediciones de la longitud rodilla-talón y rodilla-maléolo, considerarlas para los diferentes modelos de regresión parece ser una buena opción. La talla está correlacionada con el peso de forma moderada, por lo que valdría la pena explorar su contribución en los modelos propuestos. No parece haber una correlación lineal significativa entre la talla y la edad, sugiriendo que no sería necesario incluir la edad en los modelos propuestos.

En principio, dado que la relación entre cada una de las medidas de la longitud rodilla-talón y rodilla-maléolo presentan una relación lineal fuerte con la talla, se podría pensar que la que tenga una mayor correlación con la talla, es la que daría mejores estimaciones de la talla real. En este caso, la longitud rodilla-talón con antropómetro, es la que presenta una mayor correlación con la talla, por lo que posiblemente sea más preciso usar esta medida para estimar la talla real de los adultos mayores. Como sabemos, el antropómetro es una herramienta que no siempre es de fácil acceso y justamente queremos evaluar si existen diferencias significativas entre usar esta medición y las demás mediciones que sí son de fácil acceso y aplicación.


En ese orden de ideas; después de la longitud de rodilla talón con antropómetro, la longitud rodilla-talón con cinta métrica es la variable que tiene más correlación con la talla, luego sigue la longitud rodilla-maléolo con la pierna totalmente estirada y por último la longitud rodilla-maléolo con la pierna a 90 grados.

## Hipótesis

### Longitud rodilla-talón

Inicialmente se hace una comparación gráfica de ambas técnicas a través de un box-plot:

```{r}
# Comparar LRT CM y A
boxplot(data.frame(datos$LRT_CM, datos$LRT_A))
```

Según el boxplot, se puede observar que sí existe una leve diferencia entre las distribuciones de las mediciones de la longitud rodilla talón con cinta métrica y con antropómetro. Sin embargo, es necesario, realizar una prueba estadística formal para concluir algo, por lo que se calculan las diferencias entre ambos métodos y se les aplica un test de normalidad para elegir qué prueba utilizar para evaluar la hipótesis nula de que la medición de la longitud rodilla-talón con cinta métrica es igual a la medición de la longitud rodilla-talón con antropómetro.

```{r}
# Diferencias CM y A
LRT_dif <- datos$LRT_CM - datos$LRT_A

# Como se ve graficamente, parece que no hay normalidad
hist(LRT_dif)
boxplot(LRT_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRT_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRT_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```

Dado que en ambos test, Shapiro-Wilk y Lilliefors, se obtuvo un p-valor menor a $0.05$, entonces, con una significancia del $5\%$, no hay evidencia estadística de que las diferencias entre las mediciones rodilla-talón con cinta métrica y con antropómetro sigan una distribució normal. Por lo tanto, se hace necesario realizar un test no paramétrico para media de las diferencias. 

```{r}
#| eval: false
#| echo: false
# Test Wilcoxon

## Requiere simetria en los datos, por lo que se realiza un test de simetria basado en momentos
library(moments)

asimetria <- skewness(LRT_dif)

t_test <- asimetria / sqrt(6 / length(LRT_dif))  # Estadístico t
p_value <- 2 * (1 - pt(abs(t_test$Skewness), df = length(LRT_dif) - 1))
p_value # parece que no hay simetria, entonces no se puede aplicar Wilcoxon 

# wilcox.test(LRT_dif, mu = 0, alternative = "two.sided") # usando las diferencias
# wilcox.test(datos$LRT_CM, datos$LRT_A, mu = 0, alternative = "two.sided", paired = TRUE) # usando directamente los datos
```

```{r}
# Prueba del signo para muestras pareadas
## Es menos potente que Wilcoxon pero funciona aunque no haya normalidad ni simetria, permite dar conclusiones sobre la mediana (si no hay simetria)
library(BSDA)

SIGN.test(LRT_dif, md = 0, alternative = "two.sided")
```


Inicialmente, se consideró aplicar la prueba de Wilcoxon, una prueba no paramétrica diseñada para evaluar la media de las diferencias. Sin embargo, esta prueba supone que las diferencias entre las mediciones presentan simetría, lo cual no se cumplió en los datos analizados, ya que el coeficiente de asimetría obtenido fue de $-0.785$. Este valor indica una falta de simetría en las diferencias de las mediciones. Por esta razón, se optó por utilizar la prueba del signo para muestras pareadas, que no requiere supuestos de normalidad ni simetría. Aunque esta prueba no permite inferencias sobre la media, sí evalúa la mediana de las diferencias.

El resultado de la prueba del signo arrojó un p-valor de $2.2 \times 10^{-16}$, indicando evidencia estadística suficiente para rechazar la hipótesis nula de que la mediana de las diferencias es igual a cero. Por lo tanto, se concluye que las mediciones de la longitud rodilla-talón realizadas con cinta métrica no son equivalentes a las obtenidas con el antropómetro.

#### Análisis por separado

##### Por sexo 

```{r}
# Diferencias CM y A
hombres <- datos[datos$Sexo == "Masculino",]
LRT_dif <- hombres$LRT_CM - hombres$LRT_A

# Como se ve graficamente, parece que no hay normalidad
hist(LRT_dif)
boxplot(LRT_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRT_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRT_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```


```{r}
# Diferencias CM y A
mujeres <- datos[datos$Sexo == "Femenino",]
LRT_dif <- mujeres$LRT_CM - mujeres$LRT_A

# Como se ve graficamente, parece que no hay normalidad
hist(LRT_dif)
boxplot(LRT_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRT_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRT_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```

##### Por programa

```{r}
# Diferencias CM y A
cd <- datos[datos$Programa == "Centro Día Casa de la Sabiduría",]
LRT_dif <- cd$LRT_CM - cd$LRT_A

# Como se ve graficamente, parece que no hay normalidad
hist(LRT_dif)
boxplot(LRT_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRT_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRT_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```


```{r}
# Diferencias CM y A
cc <- datos[datos$Programa == "Comunidad de Cuidado",]
LRT_dif <- cc$LRT_CM - cc$LRT_A

# Como se ve graficamente, parece que no hay normalidad
hist(LRT_dif)
boxplot(LRT_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRT_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRT_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```

### Longitud rodilla-maléolo

Inicialmente se hace una comparación gráfica de ambas técnicas a través de un box-plot:

```{r}
# Comparar LRM 90 y R
boxplot(data.frame(datos$LRM_90, datos$LRM_R))
```

Según el boxplot, se puede observar que sí existe una leve diferencia entre las distribuciones de las mediciones de la longitud rodilla maléolo con la pierna a 90° y con la pierna completamente estirada. Sin embargo, es necesario, realizar una prueba estadística formal para concluir algo, por lo que se calculan las diferencias entre ambos métodos y se les aplica un test de normalidad para elegir qué prueba utilizar para evaluar la hipótesis nula de que la medición longitud rodilla-maléolo con la pierna completamente estirada es igual a la medición de la longitud rodilla-maléolo con la pierna a $90°$.

```{r}
# Diferencias CM y A
LRM_dif <- datos$LRM_90 - datos$LRM_R

# Como se ve graficamente, parece que no hay normalidad
hist(LRM_dif)
boxplot(LRM_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(LRM_dif) # No se tiene normalidad en la edad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(LRM_dif) # No se tiene normalidad en la edad según el test de Lilliefors
```

Dado que en ambos test, Shapiro-Wilk y Lilliefors, se obtuvo un p-valor menor a $0.05$, entonces, con una significancia del $5\%$, no hay evidencia estadística de que las diferencias entre las mediciones rodilla-talón con cinta métrica y con antropómetro sigan una distribució normal. Por lo tanto, se hace necesario realizar un test no paramétrico para media de las diferencias. 

```{r}
#| eval: false
#| echo: false
# Test Wilcoxon

## Requiere simetria en los datos, por lo que se realiza un test de simetria basado en momentos

asimetria <- skewness(LRM_dif)

t_test <- asimetria / sqrt(6 / length(LRM_dif))  # Estadístico t
p_value <- 2 * (1 - pt(abs(t_test$Skewness), df = length(LRM_dif) - 1))
p_value # parece que no hay simetria, entonces no se puede aplicar Wilcoxon 

# wilcox.test(LRT_dif, mu = 0, alternative = "two.sided") # usando las diferencias
# wilcox.test(datos$LRT_CM, datos$LRT_A, mu = 0, alternative = "two.sided", paired = TRUE) # usando directamente los datos
```

```{r}
# Prueba del signo para muestras pareadas
## Es menos potente que Wilcoxon pero funciona aunque no haya normalidad ni simetria, permite dar conclusiones sobre la mediana (si no hay simetria)

SIGN.test(LRM_dif, md = 0, alternative = "two.sided")
```

Nuevamente, se consideró aplicar la prueba de Wilcoxon para evaluar la media de las diferencias, pero esta prueba no se aplicó ya que el coeficiente de asimetría obtenido fue de $2.022$. Este valor indica una falta de simetría en las diferencias de las mediciones. Por esta razón, de nuevo se optó por utilizar la prueba del signo para muestras pareadas.

El resultado de la prueba del signo arrojó un p-valor de $2.2 \times 10^{-16}$, indicando evidencia estadística suficiente para rechazar la hipótesis nula de que la mediana de las diferencias es igual a cero. Por lo tanto, se concluye que las mediciones de la longitud rodilla-maléolo realizadas con la pierna completamente estirada no son equivalentes a las obtenidas con la pierna a $90°$.

### Talla real y estimación Benjumea (LRT) con cinta métrica

Primero se realiza el cálculo de la estimación de la talla utilizando las fórmulas de Benjumea que tienen en cuenta las variables Sexo, Edad, Etnia y longitud rodilla-talón con cinta métrica. Hay que tener en cuenta que en la muestra hay un individuo cuya Etnia es "Rrom", para este individuo no existe una fórmula de Benjumea para estimar su talla, por lo que no se tuvo en cuenta para la evaluación de la hipótesis de que la media de la diferencia entre la estimación de la talla por medio de las fórmulas de Benjumea y la talla real es cero.

```{r}
# Estimaciones de la talla utilizando las fórmulas de Benjumea
datos$benjumea_cm <- ifelse(
  datos$Sexo == "Masculino" & datos$Etnia == "Blanco-Mestizo",
  75.514 + 1.883 * datos$LRT_CM - 0.108 * datos$Edad,
  ifelse(
    datos$Sexo == "Femenino" & datos$Etnia == "Blanco-Mestizo",
    86.497 + 1.553 * datos$LRT_CM - 0.119 * datos$Edad,
    ifelse(
      datos$Sexo == "Masculino" & datos$Etnia == "Indigena",
      82.695 + 1.745 * datos$LRT_CM - 0.121 * datos$Edad,
      ifelse(
        datos$Sexo == "Femenino" & datos$Etnia == "Indigena",
        90.281 + 1.436 * datos$LRT_CM - 0.102 * datos$Edad,
        ifelse(
          datos$Sexo == "Masculino" & datos$Etnia == "Afrocolombiano",
          79.298 + 1.855 * datos$LRT_CM - 0.141 * datos$Edad,
          ifelse(
            datos$Sexo == "Femenino" & datos$Etnia == "Afrocolombiano",
            76.233 + 1.767 * datos$LRT_CM - 0.098 * datos$Edad,
            NA # solo hay un NA que es el Rrom
          )
        )
      )
    )
  )
)
```

Como antes, se hizo un análisis visual a través de un box-plot, donde se observa que aparentemente no hay una diferencia entre la estimación de la talla con las fórmulas de Benjumea con cinta métrica y la talla real. Sin embargo, es necesario realizar una prueba estadística formal para concluir.

```{r}
# Comparar benjumea y talla real
boxplot(data.frame(datos$Talla, datos$benjumea_cm))
```

Se calculan las diferencias entre la talla real y la estimación de la talla con las fórmulas de Benjumea con cinta métrica, luego, a estas diferencias se les aplica el test de Sahpiro-Wilk para normalidad y el test Lilliefors de normalidad, esto para decidir qué test utilizar para evaluar la media de las diferencias.

```{r}
# Diferencias benjumea y talla real
talla_dif <- datos$Talla - datos$benjumea_cm
talla_dif <- talla_dif[!is.na(talla_dif)]

# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif)
boxplot(talla_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif) # Sí se tiene normalidad según el test de Lilliefors
```

En ambos test, se obtiene un p-valor mayor a $0.05$, por lo que se afirma, que con una significancia del $5\%$, existe evidencia estadística de que las diferencias siguen una distribución normal, por lo tanto, para evaluar la media de las diferencias, se puede implementar una prueba $t$ para muestras pareadas.

```{r}
# t.test(datos$Talla, datos$benjumea, alternative = "two.sided", mu = 0, paired = TRUE, na.action = na.omit)

t.test(talla_dif, alternative = "two.sided", mu = 0)
```

Luego de aplicar la prueba $t$, con una significancia del $5\%$, existe evidencia estadística para rechazar la hipótesis nula ya que el p-valor es $2.2 \times 10^{-16}$, por lo tanto, se concluye que la media de las diferencias entre la talla real y la estimación con las fórmulas de Benjumea con cinta métrica no es cero, luego, parece que las estimaciones no son cercanas a la talla real.

#### Sin los outliers

```{r}
box_talla_dif <- boxplot(talla_dif) # hay muchos outliers
outliers <- box_talla_dif$out

talla_dif1 <- talla_dif[!(talla_dif %in% outliers)]


# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif1)
boxplot(talla_dif1) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif1) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif1)

# Prueba t para muestras pareadas
t.test(talla_dif1, alternative = "two.sided", mu = 0)
```

También da que la diferencia no es cero.

### Talla real y estimación Benjumea (LRT) con antropómetro

Primero se realiza el cálculo de la estimación de la talla utilizando las fórmulas de Benjumea que tienen en cuenta las variables Sexo, Edad, Etnia y longitud rodilla-talón con antropómetro. Hay que tener en cuenta que en la muestra hay un individuo cuya Etnia es "Rrom", para este individuo no existe una fórmula de Benjumea para estimar su talla, por lo que no se tuvo en cuenta para la evaluación de la hipótesis de que la media de la diferencia entre la estimación de la talla por medio de las fórmulas de Benjumea y la talla real es cero.

```{r}
# Estimaciones de la talla utilizando las fórmulas de Benjumea
datos$benjumea_a <- ifelse(
  datos$Sexo == "Masculino" & datos$Etnia == "Blanco-Mestizo",
  75.514 + 1.883 * datos$LRT_A - 0.108 * datos$Edad,
  ifelse(
    datos$Sexo == "Femenino" & datos$Etnia == "Blanco-Mestizo",
    86.497 + 1.553 * datos$LRT_A - 0.119 * datos$Edad,
    ifelse(
      datos$Sexo == "Masculino" & datos$Etnia == "Indigena",
      82.695 + 1.745 * datos$LRT_A - 0.121 * datos$Edad,
      ifelse(
        datos$Sexo == "Femenino" & datos$Etnia == "Indigena",
        90.281 + 1.436 * datos$LRT_A - 0.102 * datos$Edad,
        ifelse(
          datos$Sexo == "Masculino" & datos$Etnia == "Afrocolombiano",
          79.298 + 1.855 * datos$LRT_A - 0.141 * datos$Edad,
          ifelse(
            datos$Sexo == "Femenino" & datos$Etnia == "Afrocolombiano",
            76.233 + 1.767 * datos$LRT_A - 0.098 * datos$Edad,
            NA # solo hay un NA que es el Rrom
          )
        )
      )
    )
  )
)
```

Como antes, se hizo un análisis visual a través de un box-plot, donde se observa que aparentemente no hay una diferencia entre la estimación de la talla con las fórmulas de Benjumea con antropómetro y la talla real. Sin embargo, es necesario realizar una prueba estadística formal para concluir.

```{r}
# Comparar benjumea y talla real
boxplot(data.frame(datos$Talla, datos$benjumea_a))
```

Se calculan las diferencias entre la talla real y la estimación de la talla con las fórmulas de Benjumea con antropómetro, luego, a estas diferencias se les aplica el test de Sahpiro-Wilk para normalidad y el test Lilliefors de normalidad, esto para decidir qué test utilizar para evaluar la media de las diferencias.

```{r}
# Diferencias benjumea y talla real
talla_dif <- datos$Talla - datos$benjumea_a
talla_dif <- talla_dif[!is.na(talla_dif)]

# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif)
boxplot(talla_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif) # Sí se tiene normalidad según el test de Lilliefors
```

En ambos test, se obtiene un p-valor mayor a $0.05$, por lo que se afirma, que con una significancia del $5\%$, existe evidencia estadística de que las diferencias siguen una distribución normal, por lo tanto, para evaluar la media de las diferencias, se puede implementar una prueba $t$ para muestras pareadas.

```{r}
# t.test(datos$Talla, datos$benjumea, alternative = "two.sided", mu = 0, paired = TRUE, na.action = na.omit)

t.test(talla_dif, alternative = "two.sided", mu = 0)
```

Luego de aplicar la prueba $t$, con una significancia del $5\%$, existe evidencia estadística para rechazar la hipótesis nula ya que el p-valor es $4.103 \times 10^{-12}$, por lo tanto, se concluye que la media de las diferencias entre la talla real y la estimación con las fórmulas de Benjumea con antropómetro no es cero, luego, parece que las estimaciones no son cercanas a la talla real.

#### Sin los outliers

```{r}
box_talla_dif <- boxplot(talla_dif) # hay muchos outliers
outliers <- box_talla_dif$out

talla_dif1 <- talla_dif[!(talla_dif %in% outliers)]


# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif1)
boxplot(talla_dif1) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif1) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif1)

# Prueba t para muestras pareadas
t.test(talla_dif1, alternative = "two.sided", mu = 0)
```

También da que la diferencia no es cero.

### Talla real y estimación Arango Zamor (LRM) a $90°$

Primero se realiza el cálculo de la estimación de la talla utilizando las fórmulas de Arango y Zamora que tienen en cuenta las variables Sexo, Edad y longitud rodilla-maléolo a $90°$. 

```{r}
# Estimaciones de la talla utilizando las fórmulas de Benjumea
datos$arango_90 <- ifelse(
  datos$Sexo == "Masculino",
  119.6 + 1.121*datos$LRM_90 - 0.117*datos$Edad, 107.7 + 1.263*datos$LRM_90 - 0.159*datos$Edad)
```

Como antes, se hizo un análisis visual a través de un box-plot, donde se observa que aparentemente no hay una diferencia entre la estimación de la talla con las fórmulas de Arango y Zamora con la pierna a $90°$ y la talla real. Sin embargo, es necesario realizar una prueba estadística formal para concluir.

```{r}
# Comparar benjumea y talla real
boxplot(data.frame(datos$Talla, datos$arango_90))
```

Se calculan las diferencias entre la talla real y la estimación de la talla con las fórmulas de Arango y Zamora con la pierna a $90°$, luego, a estas diferencias se les aplica el test de Sahpiro-Wilk para normalidad y el test Lilliefors de normalidad, esto para decidir qué test utilizar para evaluar la media de las diferencias.

```{r}
# Diferencias benjumea y talla real
talla_dif <- datos$Talla - datos$arango_90

# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif)
boxplot(talla_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif) # Sí se tiene normalidad según el test de Lilliefors
```

En ambos test, se obtiene un p-valor mayor a $0.05$, por lo que se afirma, que con una significancia del $5\%$, existe evidencia estadística de que las diferencias siguen una distribución normal, por lo tanto, para evaluar la media de las diferencias, se puede implementar una prueba $t$ para muestras pareadas.

```{r}
# t.test(datos$Talla, datos$benjumea, alternative = "two.sided", mu = 0, paired = TRUE, na.action = na.omit)

t.test(talla_dif, alternative = "two.sided", mu = 0)
```

Luego de aplicar la prueba $t$, con una significancia del $5\%$, existe evidencia estadística para rechazar la hipótesis nula ya que el p-valor es $9.685 \times 10^{-12}$, por lo tanto, se concluye que la media de las diferencias entre la talla real y la estimación con las fórmulas de Arango y Zamora con la pierna a $90°$ no es cero, luego, parece que las estimaciones no son cercanas a la talla real.

#### Sin los outliers

```{r}
box_talla_dif <- boxplot(talla_dif) # hay muchos outliers
outliers <- box_talla_dif$out

talla_dif1 <- talla_dif[!(talla_dif %in% outliers)]


# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif1)
boxplot(talla_dif1) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif1) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif1)

# Prueba t para muestras pareadas
t.test(talla_dif1, alternative = "two.sided", mu = 0)
```

También da que la diferencia no es cero.

### Talla real y estimación Arango Zamor (LRM) con la pierna estirada

Primero se realiza el cálculo de la estimación de la talla utilizando las fórmulas de Arango y Zamora que tienen en cuenta las variables Sexo, Edad y longitud rodilla-maléolo con la pierna estirada. 

```{r}
# Estimaciones de la talla utilizando las fórmulas de Benjumea
datos$arango_r <- ifelse(
  datos$Sexo == "Masculino",
  119.6 + 1.121*datos$LRM_R - 0.117*datos$Edad, 107.7 + 1.263*datos$LRM_R - 0.159*datos$Edad)
```

Como antes, se hizo un análisis visual a través de un box-plot, donde se observa que aparentemente no hay una diferencia entre la estimación de la talla con las fórmulas de Arango y Zamora con la pierna estirada y la talla real. Sin embargo, es necesario realizar una prueba estadística formal para concluir.

```{r}
# Comparar benjumea y talla real
boxplot(data.frame(datos$Talla, datos$arango_r))
```

Se calculan las diferencias entre la talla real y la estimación de la talla con las fórmulas de Arango y Zamora con la pierna a estirada, luego, a estas diferencias se les aplica el test de Sahpiro-Wilk para normalidad y el test Lilliefors de normalidad, esto para decidir qué test utilizar para evaluar la media de las diferencias.

```{r}
# Diferencias benjumea y talla real
talla_dif <- datos$Talla - datos$arango_r

# Como se ve graficamente, parece que no hay normalidad
hist(talla_dif)
boxplot(talla_dif) # hay muchos outliers

# Pruebas de normalidad
## Test Shapiro-Wilk
shapiro.test(talla_dif) # Sí se tiene normalidad según el test de Shapiro-Wilks

## Test lilliefors
lillie.test(talla_dif) # Sí se tiene normalidad según el test de Lilliefors
```

En ambos test, se obtiene un p-valor mayor a $0.05$, por lo que se afirma, que con una significancia del $5\%$, existe evidencia estadística de que las diferencias siguen una distribución normal, por lo tanto, para evaluar la media de las diferencias, se puede implementar una prueba $t$ para muestras pareadas.

```{r}
# t.test(datos$Talla, datos$benjumea, alternative = "two.sided", mu = 0, paired = TRUE, na.action = na.omit)

t.test(talla_dif, alternative = "two.sided", mu = 0)
```

Luego de aplicar la prueba $t$, con una significancia del $5\%$, existe evidencia estadística para rechazar la hipótesis nula ya que el p-valor es $2.2 \times 10^{-16}$, por lo tanto, se concluye que la media de las diferencias entre la talla real y la estimación con las fórmulas de Arango y Zamora con la pierna estirada no es cero, luego, parece que las estimaciones no son cercanas a la talla real.

## Modelos