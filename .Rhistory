datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 75.514 + 1.883*datos_copia$LRT_A - 0.108*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Blanco-Mestizo femenino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 86.497 + 1.553*datos_copia$LRT_A - 0.119*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Indigena masculino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Indigena", 82.695 + 1.745*datos_copia$LRT_A - 0.121*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Indigena femenino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Indigena", 90.281 + 1.436*datos_copia$LRT_A - 0.102*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Afrodescendiente masculino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Afrocolombiano", 79.298 + 1.855*datos_copia$LRT_A - 0.141*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Afrodescendiente femenino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Afrocolombiano", 76.233 + 1.767*datos_copia$LRT_A - 0.098*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Blanco-Mestizo masculino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 75.514 + 1.883*datos_copia$LRT_A - 0.108*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
# Blanco-Mestizo femenino
datos_copia$Benjumea_LRT_A = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 86.497 + 1.553*datos_copia$LRT_A - 0.119*datos_copia$Edad, datos_copia$Benjumea_LRT_A)
```
# Para almacenar las estimaciones en un excel
# LRT_A
datos_copia$Benjumea_LRT_CM = rep(NA,nrow(datos_copia))
# Indigena masculino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Indigena", 82.695 + 1.745*datos_copia$LRT_CM - 0.121*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
# Indigena femenino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Indigena", 90.281 + 1.436*datos_copia$LRT_CM - 0.102*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
# Afrodescendiente masculino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Afrocolombiano", 79.298 + 1.855*datos_copia$LRT_CM - 0.141*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
# Afrodescendiente femenino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Afrocolombiano", 76.233 + 1.767*datos_copia$LRT_CM - 0.098*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
# Blanco-Mestizo masculino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo=="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 75.514 + 1.883*datos_copia$LRT_CM - 0.108*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
# Blanco-Mestizo femenino
datos_copia$Benjumea_LRT_CM = ifelse(datos_copia$Sexo!="Masculino" & datos_copia$Etnia == "Blanco-Mestizo", 86.497 + 1.553*datos_copia$LRT_CM - 0.119*datos_copia$Edad, datos_copia$Benjumea_LRT_CM)
library(writexlsx)
library(writexl)
install.packages("writexl")
library(writexl)
write_xlsx(datos_copia, "Estimaciones.xlsx")
str(datos_copia)
write_xlsx(datos_copia[,-1], "Estimaciones.xlsx")
# Para almacenar las estimaciones en un excel
# LRM_R
datos_copia$Arango_LRM_R = rep(NA,nrow(datos_copia))
# Masculino
datos_copia$Arango_LRM_R = ifelse(datos_copia$Sexo=="Masculino", 119.6 + 1.121*datos_copia$LRM_R - 0.117*datos_copia$Edad, datos_copia$Arango_LRM_R)
# Femenino
datos_copia$Arango_LRM_R = ifelse(datos_copia$Sexo!="Masculino", 107.7 + 1.263*datos_copia$LRM_R - 0.159*datos_copia$Edad, datos_copia$Arango_LRM_R)
# Para almacenar las estimaciones en un excel
# LRM_90
datos_copia$Arango_LRM_90 = rep(NA,nrow(datos_copia))
# Masculino
datos_copia$Arango_LRM_90 = ifelse(datos_copia$Sexo=="Masculino", 119.6 + 1.121*datos_copia$LRM_90 - 0.117*datos_copia$Edad, datos_copia$Arango_LRM_90)
# Femenino
datos_copia$Arango_LRM_90 = ifelse(datos_copia$Sexo!="Masculino", 107.7 + 1.263*datos_copia$LRM_90 - 0.159*datos_copia$Edad, datos_copia$Arango_LRM_90)
# Escribimos el excel con las estimaciones
library(writexl)
write_xlsx(datos_copia[,-1], "Estimaciones.xlsx")
nombres <- c("Femenino", "Masculino")
cbind(nombres, modelos_tab)
# Librerias
library(readxl)
library(tidyverse)
library(nortest)
library(dplyr)
library(ggplot2)
library(GGally) # para la funcion ggpairs
library(gt)
library(gtExtras)
library(moments)
library(leaps)
library(MASS)
library(lmtest)
library(car)
library(BSDA) # Test del signo
library(glmnet)
library(glmtoolbox)
library(MASS)
library(rsample)
library(lawstat)
library(caret) # Para particion train test
read_xlsx("Datos/Estimaciones.xlsx")
hola <- read_xlsx("Datos/Estimaciones.xlsx")
str(hola)
str(datos)
datos <- read_excel("Datos/Corregida - COMPILADO DATOS COMUNIDAD DE CUIDADO Y CENTRO DÍA.xlsx",
range = "B2:AN561", col_types = c("date",
"skip", "text", "text", "text", "skip",
"text", "numeric", "text", "skip",
"skip", "skip", "skip", "numeric",
"skip", "skip", "skip", "skip", "numeric",
"skip", "skip", "skip", "skip", "numeric",
"skip", "skip", "skip", "skip", "numeric",
"skip", "skip", "skip", "skip", "numeric",
"skip", "skip", "skip", "skip", "numeric"))
colnames(datos) <- c("Fecha", "Localidad", "Programa", "Unidad_atencion",
"Sexo", "Edad", "Etnia", "Peso", "Talla",
"LRT_CM","LRT_A", "LRM_90","LRM_R")
datos$Sexo <- as.factor(datos$Sexo)
datos$Etnia <- as.factor(datos$Etnia)
datos <- datos[-which(datos$Edad<60),] # >60
datos <- datos |> filter(!(abs(LRT_A-LRT_CM) > 3 | abs(LRM_90-LRM_R) > 3))
datos <- datos |> as.data.frame()
str(datos)
estimaciones$Sexo <- as.factor(estimaciones$Sexo)
estimaciones <- read_xlsx("Datos/Estimaciones.xlsx")
estimaciones$Sexo <- as.factor(estimaciones$Sexo)
estimaciones$Etnia <- as.factor(estimaciones$Etnia)
rm(hola)
View(estimaciones)
estimaciones$IMC <- estimaciones$Peso/(estimaciones$Talla/100)^2
estimaciones$IMC_Normal_LRT_A <- estimaciones$Peso/(estimaciones$Normal_LRT_A/100)^2
estimaciones$IMC_Normal_LRT_CM <- estimaciones$Peso/(estimaciones$Normal_LRT_CM/100)^2
estimaciones$IMC_Benjumea_LRT_A <- estimaciones$Peso/(estimaciones$Benjumea_LRT_A/100)^2
estimaciones$IMC_Benjumea_LRT_CM <- estimaciones$Peso/(estimaciones$Benjumea_LRT_CM/100)^2
estimaciones$IMC_Arango_LRM_R <- estimaciones$Peso/(estimaciones$Arango_LRM_R/100)^2
estimaciones$IMC_Arango_LRM_90 <- estimaciones$Peso/(estimaciones$Arango_LRM_90/100)^2
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Normal","Obsesidad")))
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Normal_LRT_A <- ifelse(estimaciones$IMC_Normal_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_A>=18.5 & estimaciones$IMC_Normal_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_A>=25 & estimaciones$IMC_Normal_LRT_A<30, "Soprepeso","Obsesidad")))
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Normal_LRT_A <- ifelse(estimaciones$IMC_Normal_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_A>=18.5 & estimaciones$IMC_Normal_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_A>=25 & estimaciones$IMC_Normal_LRT_A<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Normal_LRT_CM <- ifelse(estimaciones$IMC_Normal_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_CM>=18.5 & estimaciones$IMC_Normal_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_CM>=25 & estimaciones$IMC_Normal_LRT_CM<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Benjumea_LRT_A <- ifelse(estimaciones$IMC_Benjumea_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_A>=18.5 & estimaciones$IMC_Benjumea_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_A>=25 & estimaciones$IMC_Benjumea_LRT_A<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Benjumea_LRT_CM <- ifelse(estimaciones$IMC_Benjumea_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=18.5 & estimaciones$IMC_Benjumea_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=25 & estimaciones$IMC_Benjumea_LRT_CM<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Arango_LRM_R <- ifelse(estimaciones$IMC_Arango_LRM_R<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_R>=18.5 & estimaciones$IMC_Arango_LRM_R<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_R>=25 & estimaciones$IMC_Arango_LRM_R<30, "Soprepeso","Obsesidad")))
estimaciones$Clasificacion_Arango_LRM_90 <- ifelse(estimaciones$IMC_Arango_LRM_90<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_90>=18.5 & estimaciones$IMC_Arango_LRM_90<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_90>=25 & estimaciones$IMC_Arango_LRM_90<30, "Soprepeso","Obsesidad")))
sum(estimaciones$Clasificacion == "Delgadez")
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = num(),
Normal = num(),
Sobrepeso = num(),
Obesidad = num())
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
proporciones_tab <- rbind(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n)
View(proporciones_tab)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_A <- ifelse(estimaciones$IMC_Normal_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_A>=18.5 & estimaciones$IMC_Normal_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_A>=25 & estimaciones$IMC_Normal_LRT_A<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_CM <- ifelse(estimaciones$IMC_Normal_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_CM>=18.5 & estimaciones$IMC_Normal_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_CM>=25 & estimaciones$IMC_Normal_LRT_CM<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_A <- ifelse(estimaciones$IMC_Benjumea_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_A>=18.5 & estimaciones$IMC_Benjumea_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_A>=25 & estimaciones$IMC_Benjumea_LRT_A<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_CM <- ifelse(estimaciones$IMC_Benjumea_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=18.5 & estimaciones$IMC_Benjumea_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=25 & estimaciones$IMC_Benjumea_LRT_CM<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_R <- ifelse(estimaciones$IMC_Arango_LRM_R<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_R>=18.5 & estimaciones$IMC_Arango_LRM_R<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_R>=25 & estimaciones$IMC_Arango_LRM_R<30, "Soprepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_90 <- ifelse(estimaciones$IMC_Arango_LRM_90<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_90>=18.5 & estimaciones$IMC_Arango_LRM_90<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_90>=25 & estimaciones$IMC_Arango_LRM_90<30, "Soprepeso","Obesidad")))
# Proporciones
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Proporciones
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
# Real
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Normal_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_A == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_A == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_A == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_A == "Obesidad")/n))
# Normal_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Obesidad")/n))
# Benjumea_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Obesidad")/n))
# Benjumea_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Obesidad")/n))
# Arango_LRM_R
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_R",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_R == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_R == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_R == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_R == "Obesidad")/n))
# Arango_LRM_90
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_90",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Obesidad")/n))
sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Delgadez")
?sum
# Proporciones
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
# Real
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Normal_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_A == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_A == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_A == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_A == "Obesidad")/n))
# Normal_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Obesidad")/n))
# Benjumea_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Obesidad", na.rm = T)/n))
# Benjumea_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Obesidad", na.rm = T)/n))
# Arango_LRM_R
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_R",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_R == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_R == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_R == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_R == "Obesidad")/n))
# Arango_LRM_90
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_90",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Obesidad")/n))
sum(estimaciones$Clasificacion == "Sobrepeso")
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_A <- ifelse(estimaciones$IMC_Normal_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_A>=18.5 & estimaciones$IMC_Normal_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_A>=25 & estimaciones$IMC_Normal_LRT_A<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_CM <- ifelse(estimaciones$IMC_Normal_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_CM>=18.5 & estimaciones$IMC_Normal_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_CM>=25 & estimaciones$IMC_Normal_LRT_CM<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_A <- ifelse(estimaciones$IMC_Benjumea_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_A>=18.5 & estimaciones$IMC_Benjumea_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_A>=25 & estimaciones$IMC_Benjumea_LRT_A<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_CM <- ifelse(estimaciones$IMC_Benjumea_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=18.5 & estimaciones$IMC_Benjumea_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=25 & estimaciones$IMC_Benjumea_LRT_CM<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_R <- ifelse(estimaciones$IMC_Arango_LRM_R<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_R>=18.5 & estimaciones$IMC_Arango_LRM_R<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_R>=25 & estimaciones$IMC_Arango_LRM_R<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_90 <- ifelse(estimaciones$IMC_Arango_LRM_90<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_90>=18.5 & estimaciones$IMC_Arango_LRM_90<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_90>=25 & estimaciones$IMC_Arango_LRM_90<30, "Sobrepeso","Obesidad")))
# Proporciones
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
# Real
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Normal_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_A == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_A == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_A == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_A == "Obesidad")/n))
# Normal_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Obesidad")/n))
# Benjumea_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Obesidad", na.rm = T)/n))
# Benjumea_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Obesidad", na.rm = T)/n))
# Arango_LRM_R
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_R",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_R == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_R == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_R == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_R == "Obesidad")/n))
# Arango_LRM_90
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_90",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Obesidad")/n))
# Separar la fila real y los modelos
real_values <- proporciones_tab %>% filter(Estimacion == "Real") %>% select(-Estimacion)
# Librerias
library(readxl)
library(tidyverse)
library(nortest)
library(dplyr)
library(ggplot2)
library(GGally) # para la funcion ggpairs
library(gt)
library(gtExtras)
library(moments)
library(leaps)
library(MASS)
library(lmtest)
library(car)
library(BSDA) # Test del signo
library(glmnet)
library(glmtoolbox)
library(MASS)
library(rsample)
library(lawstat)
library(caret) # Para particion train test
# Lectura de la base de datos
estimaciones <- read_xlsx("Datos/Estimaciones.xlsx")
estimaciones$Sexo <- as.factor(estimaciones$Sexo)
estimaciones$Etnia <- as.factor(estimaciones$Etnia)
# El IMC es peso en kg sobre altura en metros cuadrados
estimaciones$IMC <- estimaciones$Peso/(estimaciones$Talla/100)^2
estimaciones$IMC_Normal_LRT_A <- estimaciones$Peso/(estimaciones$Normal_LRT_A/100)^2
estimaciones$IMC_Normal_LRT_CM <- estimaciones$Peso/(estimaciones$Normal_LRT_CM/100)^2
estimaciones$IMC_Benjumea_LRT_A <- estimaciones$Peso/(estimaciones$Benjumea_LRT_A/100)^2
estimaciones$IMC_Benjumea_LRT_CM <- estimaciones$Peso/(estimaciones$Benjumea_LRT_CM/100)^2
estimaciones$IMC_Arango_LRM_R <- estimaciones$Peso/(estimaciones$Arango_LRM_R/100)^2
estimaciones$IMC_Arango_LRM_90 <- estimaciones$Peso/(estimaciones$Arango_LRM_90/100)^2
# Clasificacion nutricional
estimaciones$Clasificacion <- ifelse(estimaciones$IMC<18.5, "Delgadez", ifelse(estimaciones$IMC>=18.5 & estimaciones$IMC<25, "Normal", ifelse(estimaciones$IMC>=25 & estimaciones$IMC<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_A <- ifelse(estimaciones$IMC_Normal_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_A>=18.5 & estimaciones$IMC_Normal_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_A>=25 & estimaciones$IMC_Normal_LRT_A<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Normal_LRT_CM <- ifelse(estimaciones$IMC_Normal_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Normal_LRT_CM>=18.5 & estimaciones$IMC_Normal_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Normal_LRT_CM>=25 & estimaciones$IMC_Normal_LRT_CM<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_A <- ifelse(estimaciones$IMC_Benjumea_LRT_A<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_A>=18.5 & estimaciones$IMC_Benjumea_LRT_A<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_A>=25 & estimaciones$IMC_Benjumea_LRT_A<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Benjumea_LRT_CM <- ifelse(estimaciones$IMC_Benjumea_LRT_CM<18.5, "Delgadez", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=18.5 & estimaciones$IMC_Benjumea_LRT_CM<25, "Normal", ifelse(estimaciones$IMC_Benjumea_LRT_CM>=25 & estimaciones$IMC_Benjumea_LRT_CM<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_R <- ifelse(estimaciones$IMC_Arango_LRM_R<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_R>=18.5 & estimaciones$IMC_Arango_LRM_R<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_R>=25 & estimaciones$IMC_Arango_LRM_R<30, "Sobrepeso","Obesidad")))
estimaciones$Clasificacion_Arango_LRM_90 <- ifelse(estimaciones$IMC_Arango_LRM_90<18.5, "Delgadez", ifelse(estimaciones$IMC_Arango_LRM_90>=18.5 & estimaciones$IMC_Arango_LRM_90<25, "Normal", ifelse(estimaciones$IMC_Arango_LRM_90>=25 & estimaciones$IMC_Arango_LRM_90<30, "Sobrepeso","Obesidad")))
# Proporciones
n <- nrow(estimaciones)
proporciones_tab <- data.frame(Estimacion = character(),
Delgadez = numeric(),
Normal = numeric(),
Sobrepeso = numeric(),
Obesidad = numeric())
# Real
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Real",
Delgadez = sum(estimaciones$Clasificacion == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion == "Obesidad")/n))
# Normal_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_A == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_A == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_A == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_A == "Obesidad")/n))
# Normal_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Normal_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Normal_LRT_CM == "Obesidad")/n))
# Benjumea_LRT_A
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_A",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_A == "Obesidad", na.rm = T)/n))
# Benjumea_LRT_CM
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Benjumea_LRT_CM",
Delgadez = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Delgadez", na.rm = T)/n,
Normal = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Normal", na.rm = T)/n,
Sobrepeso = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Sobrepeso", na.rm = T)/n,
Obesidad = sum(estimaciones$Clasificacion_Benjumea_LRT_CM == "Obesidad", na.rm = T)/n))
# Arango_LRM_R
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_R",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_R == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_R == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_R == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_R == "Obesidad")/n))
# Arango_LRM_90
proporciones_tab <- rbind(proporciones_tab, data.frame(Estimacion = "Arango_LRM_90",
Delgadez = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Delgadez")/n,
Normal = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Normal")/n,
Sobrepeso = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Sobrepeso")/n,
Obesidad = sum(estimaciones$Clasificacion_Arango_LRM_90 == "Obesidad")/n))
# Separar la fila real y los modelos
real_values <- proporciones_tab %>% filter(Estimacion == "Real") %>% select(-Estimacion)
library(dplyr)
real_values <- proporciones_tab %>% filter(Estimacion == "Real") %>% select(-Estimacion)
real_values <- subset(proporciones_tab, Estimacion == "Real")[, !names(proporciones_tab) %in% "Estimacion"]
View(real_values)
model_estimations <- subset(proporciones_tab, Estimacion != "Real")[, !names(proporciones_tab) %in% "Estimacion"]
View(model_estimations)
# Calcular el error absoluto ponderado por categoría
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values))) %>%
select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
# Calcular el error absoluto ponderado por categoría
library(dplyr)
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values))) %>%
select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values)))
View(error_df)
model_estimations <- subset(proporciones_tab, Estimacion != "Real")
# Calcular el error absoluto ponderado por categoría
library(dplyr)
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values))) %>%
select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values)))
error_df %>%
select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
error_df %>%
select(EstimacioN) %>%
arrange(Error_Ponderado)
error_df %>%
select(Estimacion) %>%
arrange(Error_Ponderado)
error_df %>% select_(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
error_df %>% select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
?select
error_df %>% dplyr::select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
error_df <- model_estimations %>%
mutate(across(Delgadez:Obesidad, ~abs(. - real_values[[cur_column()]]))) %>%
rowwise() %>%
mutate(Error_Ponderado = sum(c_across(Delgadez:Obesidad) * unlist(real_values))) %>%
dplyr::select(Estimacion, Error_Ponderado) %>%
arrange(Error_Ponderado)
# Mostrar el modelo con menor error
error_df
# Mostrar el modelo con menor error
error_df |> gt()
proporciones_tab |> gt()
library(ggplot2)
library(dplyr)
library(tidyr)
# Transformar a formato largo
df_long <- df %>%
pivot_longer(cols = Delgadez:Obesidad, names_to = "Categoria", values_to = "Proporcion")
?pivot_longer
# Transformar a formato largo
df_long <- proporciones_tab %>%
pivot_longer(cols = Delgadez:Obesidad, names_to = "Categoria", values_to = "Proporcion")
# Gráfico de barras apiladas
ggplot(df_long, aes(x = Estimacion, y = Proporcion, fill = Categoria)) +
geom_bar(stat = "identity", position = "fill") +  # "fill" para proporciones
scale_y_continuous(labels = scales::percent) +    # Convertir eje Y a porcentaje
labs(x = "Estimación", y = "Proporción", fill = "Categoría",
title = "Comparación de proporciones por estimación") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotar etiquetas para mejor visibilidad
head(estimaciones) |> gt()
